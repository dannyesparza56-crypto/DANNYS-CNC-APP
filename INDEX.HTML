<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNC Macro B Gen</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .block { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input { width: 80px; margin: 5px; padding: 5px; }
        textarea { width: 100%; height: 200px; font-family: monospace; margin-top: 10px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>CNC Macro B Gen (G20)</h2>
    
    <div class="block">
        <h3>Global Settings</h3>
        T#: <input type="number" id="tool" value="1">
        RPM: <input type="number" id="speed" value="2000">
        Feed: <input type="number" id="feed" value="10.0"><br>
        Z-Safe: <input type="number" id="zSafe" value="1.0">
        Retract: <input type="number" id="retract" value="0.1">
    </div>

    <div class="block">
        <h3>Linear Holes (X-Axis)</h3>
        Start X: <input type="number" id="startX" value="0">
        Start Y: <input type="number" id="startY" value="0">
        Depth: <input type="number" id="depth" value="0.5">
        Qty: <input type="number" id="qty" value="3">
        Spacing: <input type="number" id="space" value="1.0">
        <br><button onclick="generateLinear()">Generate G-Code</button>
    </div>

    <textarea id="output" readonly></textarea>

    <script>
        function generateLinear() {
            let T = document.getElementById('tool').value;
            let S = document.getElementById('speed').value;
            let F = document.getElementById('feed').value;
            let ZS = document.getElementById('zSafe').value;
            let R = document.getElementById('retract').value;
            let Qty = document.getElementById('qty').value;
            let Space = document.getElementById('space').value;
            let Depth = document.getElementById('depth').value;
            let X = parseFloat(document.getElementById('startX').value);
            let Y = document.getElementById('startY').value;

            let gcode = `%\nO1001 (LINEAR HOLES)\nG20 G90 G17 G40\nT${T} M6\nS${S} M3\nG54 G0 X${X} Y${Y}\nG43 H${T} Z${ZS} M8\n`;
            
            for(let i=0; i < Qty; i++) {
                let nextX = X + (i * Space);
                gcode += `G81 G99 X${nextX.toFixed(4)} Y${Y} Z-${Depth} R${R} F${F}\n`;
            }
            
            gcode += `G80\nG0 Z${ZS} M9\nG53 Z0 M5\nM30\n%`;
            document.getElementById('output').value = gcode;
        }

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
